import{r as u,b as X,c as Y,m as Z,d as S,o as v,e as j,M as h,f as a,g as o,h as r,a2 as ee,p as M,H as f,E as m,k as i,t as z,K as te,Q as ae,R as le,a3 as oe}from"./index-BI8oO-SX.js";import{f as ne}from"./date-B59vURDm.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re={class:"departments-page"},de={class:"page-header"},ie={__name:"Departments",setup(ue){const T=ne,b=u(!1),D=u([]),y=u([]),V=u(1),k=u(10),U=u(0),p=u(!1),x=u("新增部门"),w=u(null),l=X({id:null,name:"",parent_id:null,status:1,sort:0,description:""}),N={name:[{required:!0,message:"请输入部门名称",trigger:"blur"}]},O=Y(()=>l.id?y.value.filter(n=>n.id!==l.id):y.value),_=async()=>{b.value=!0;try{const n=await f.get(`/departments?page=${V.value}&page_size=${k.value}`);D.value=n.data.data||[],U.value=n.data.total||0}catch{m.error("加载部门列表失败")}finally{b.value=!1}},C=async()=>{try{const n=await f.get("/departments?status=1&simple=1");y.value=n.data.data||[]}catch(n){console.error("加载全部部门失败",n)}},R=()=>{x.value="新增部门",Object.assign(l,{id:null,name:"",parent_id:null,status:1,sort:0,description:""}),p.value=!0},A=n=>{x.value="编辑部门",Object.assign(l,{id:n.id,name:n.name,parent_id:n.parent_id??null,status:n.status,sort:n.sort,description:n.description||""}),p.value=!0},q=async n=>{var e,d;try{await oe.confirm("确定要删除该部门吗？","提示",{type:"warning"}),await f.delete(`/departments/${n.id}`),m.success("删除成功"),_(),C()}catch(s){s!=="cancel"&&m.error(((d=(e=s.response)==null?void 0:e.data)==null?void 0:d.error)||"删除失败")}},F=async()=>{w.value&&await w.value.validate(async n=>{var e,d;if(n)try{const s={name:l.name,parent_id:l.parent_id,status:l.status,sort:l.sort,description:l.description};l.id?(await f.put(`/departments/${l.id}`,s),m.success("更新成功")):(await f.post("/departments",s),m.success("创建成功")),p.value=!1,_(),C()}catch(s){m.error(((d=(e=s.response)==null?void 0:e.data)==null?void 0:d.error)||"操作失败")}})};return Z(()=>{_(),C()}),(n,e)=>{const d=r("el-button"),s=r("el-table-column"),H=r("el-tag"),I=r("el-table"),K=r("el-pagination"),$=r("el-input"),c=r("el-form-item"),B=r("el-option"),L=r("el-select"),E=r("el-radio"),P=r("el-radio-group"),Q=r("el-input-number"),G=r("el-form"),J=r("el-dialog"),W=ee("loading");return v(),S("div",re,[j("div",de,[e[10]||(e[10]=j("h2",null,"部门管理",-1)),a(d,{type:"primary",onClick:R},{default:o(()=>[...e[9]||(e[9]=[i("新增部门",-1)])]),_:1})]),h((v(),M(I,{data:D.value,style:{"margin-top":"20px"}},{default:o(()=>[a(s,{prop:"sort",label:"排序",width:"100"}),a(s,{prop:"name",label:"部门名称",width:"180"}),a(s,{label:"上级部门",width:"180"},{default:o(({row:t})=>{var g;return[i(z(((g=t.parent)==null?void 0:g.name)||"-"),1)]}),_:1}),a(s,{prop:"status",label:"状态",width:"120"},{default:o(({row:t})=>[a(H,{type:t.status===1?"success":"danger"},{default:o(()=>[i(z(t.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(s,{prop:"description",label:"描述"}),a(s,{prop:"created_at",label:"创建时间",width:"180"},{default:o(({row:t})=>[i(z(te(T)(t.created_at)),1)]),_:1}),a(s,{label:"操作",width:"200"},{default:o(({row:t})=>[a(d,{size:"small",onClick:g=>A(t)},{default:o(()=>[...e[11]||(e[11]=[i("编辑",-1)])]),_:1},8,["onClick"]),a(d,{size:"small",type:"danger",onClick:g=>q(t)},{default:o(()=>[...e[12]||(e[12]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[W,b.value]]),a(K,{"current-page":V.value,"onUpdate:currentPage":e[0]||(e[0]=t=>V.value=t),"page-size":k.value,"onUpdate:pageSize":e[1]||(e[1]=t=>k.value=t),total:U.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:_,onCurrentChange:_,style:{"margin-top":"20px"}},null,8,["current-page","page-size","total"]),a(J,{modelValue:p.value,"onUpdate:modelValue":e[8]||(e[8]=t=>p.value=t),title:x.value,width:"520px"},{footer:o(()=>[a(d,{onClick:e[7]||(e[7]=t=>p.value=!1)},{default:o(()=>[...e[15]||(e[15]=[i("取消",-1)])]),_:1}),a(d,{type:"primary",onClick:F},{default:o(()=>[...e[16]||(e[16]=[i("确定",-1)])]),_:1})]),default:o(()=>[a(G,{model:l,rules:N,ref_key:"formRef",ref:w,"label-width":"100px"},{default:o(()=>[a(c,{label:"部门名称",prop:"name"},{default:o(()=>[a($,{modelValue:l.name,"onUpdate:modelValue":e[2]||(e[2]=t=>l.name=t)},null,8,["modelValue"])]),_:1}),a(c,{label:"上级部门",prop:"parent_id"},{default:o(()=>[a(L,{modelValue:l.parent_id,"onUpdate:modelValue":e[3]||(e[3]=t=>l.parent_id=t),placeholder:"请选择上级部门",clearable:""},{default:o(()=>[a(B,{label:"无",value:null}),(v(!0),S(ae,null,le(O.value,t=>(v(),M(B,{key:t.id,label:t.name,value:t.id,disabled:t.id===l.id},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"状态",prop:"status"},{default:o(()=>[a(P,{modelValue:l.status,"onUpdate:modelValue":e[4]||(e[4]=t=>l.status=t)},{default:o(()=>[a(E,{value:1},{default:o(()=>[...e[13]||(e[13]=[i("启用",-1)])]),_:1}),a(E,{value:0},{default:o(()=>[...e[14]||(e[14]=[i("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"排序",prop:"sort"},{default:o(()=>[a(Q,{modelValue:l.sort,"onUpdate:modelValue":e[5]||(e[5]=t=>l.sort=t),min:0,max:9999},null,8,["modelValue"])]),_:1}),a(c,{label:"描述",prop:"description"},{default:o(()=>[a($,{modelValue:l.description,"onUpdate:modelValue":e[6]||(e[6]=t=>l.description=t),type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ce=se(ie,[["__scopeId","data-v-a0b1dd0d"]]);export{ce as default};
