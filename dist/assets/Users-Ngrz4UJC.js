import{r as d,b as h,m as ee,d as C,o as _,e as S,M as le,f as t,g as a,h as n,a2 as te,p as $,H as f,E as g,k as r,t as b,Q as N,R as O,a3 as ae}from"./index-BI8oO-SX.js";import{f as oe}from"./date-B59vURDm.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ne={class:"users-page"},re={class:"page-header"},ue={__name:"Users",setup(de){const A=o=>o?oe(o):"",V=d(!1),B=d([]),T=d([]),D=d([]),w=d(1),k=d(10),E=d(0),m=d(!1),x=d("新增用户"),U=d(null),s=h({id:null,username:"",password:"",email:"",role_id:null,department_id:null,employee_type:"internal",status:1}),F={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱",trigger:"blur"}],role_id:[{required:!0,message:"请选择角色",trigger:"change"}],department_id:[{required:!0,message:"请选择所属部门",trigger:"change"}],employee_type:[{required:!0,message:"请选择员工类型",trigger:"change"}]},y=async()=>{V.value=!0;try{const o=await f.get(`/users?page=${w.value}&page_size=${k.value}`);B.value=o.data.data,E.value=o.data.total}catch{g.error("加载用户列表失败")}finally{V.value=!1}},H=async()=>{try{const o=await f.get("/roles?page=1&page_size=100");T.value=o.data.data}catch(o){console.error("加载角色列表失败",o)}},I=async()=>{try{const o=await f.get("/departments?page=1&page_size=200&status=1");D.value=o.data.data||[]}catch(o){console.error("加载部门列表失败",o)}},L=o=>o==="external"?"外部员工":"内部员工",P=()=>{x.value="新增用户",Object.assign(s,{id:null,username:"",password:"",email:"",role_id:null,department_id:null,employee_type:"internal",status:1}),m.value=!0},Q=o=>{x.value="编辑用户",Object.assign(s,{id:o.id,username:o.username,password:"",email:o.email,role_id:o.role_id,department_id:o.department_id,employee_type:o.employee_type||"internal",status:o.status}),m.value=!0},G=async o=>{try{await ae.confirm("确定要删除该用户吗？","提示",{type:"warning"}),await f.delete(`/users/${o.id}`),g.success("删除成功"),y()}catch(e){e!=="cancel"&&g.error("删除失败")}},J=async()=>{U.value&&await U.value.validate(async o=>{var e,i;if(o)try{s.id?(await f.put(`/users/${s.id}`,s),g.success("更新成功")):(await f.post("/users",s),g.success("创建成功")),m.value=!1,y()}catch(u){g.error(((i=(e=u.response)==null?void 0:e.data)==null?void 0:i.error)||"操作失败")}})};return ee(()=>{y(),H(),I()}),(o,e)=>{const i=n("el-button"),u=n("el-table-column"),j=n("el-tag"),K=n("el-table"),W=n("el-pagination"),z=n("el-input"),p=n("el-form-item"),q=n("el-option"),M=n("el-select"),v=n("el-radio"),R=n("el-radio-group"),X=n("el-form"),Y=n("el-dialog"),Z=te("loading");return _(),C("div",ne,[S("div",re,[e[12]||(e[12]=S("h2",null,"用户管理",-1)),t(i,{type:"primary",onClick:P},{default:a(()=>[...e[11]||(e[11]=[r("新增用户",-1)])]),_:1})]),le((_(),$(K,{data:B.value,style:{"margin-top":"20px"}},{default:a(()=>[t(u,{prop:"username",label:"用户名",width:"160"}),t(u,{prop:"email",label:"邮箱"}),t(u,{label:"所属部门",width:"180"},{default:a(({row:l})=>{var c;return[r(b(((c=l.department)==null?void 0:c.name)||"-"),1)]}),_:1}),t(u,{label:"员工类型",width:"140"},{default:a(({row:l})=>[t(j,{type:l.employee_type==="internal"?"success":"warning"},{default:a(()=>[r(b(L(l.employee_type)),1)]),_:2},1032,["type"])]),_:1}),t(u,{prop:"role.name",label:"角色"}),t(u,{prop:"status",label:"状态"},{default:a(({row:l})=>[t(j,{type:l.status===1?"success":"danger"},{default:a(()=>[r(b(l.status===1?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(u,{prop:"created_at",label:"创建时间",width:"180"},{default:a(({row:l})=>[r(b(l.created_at?A(l.created_at):""),1)]),_:1}),t(u,{label:"操作",width:"200"},{default:a(({row:l})=>[t(i,{size:"small",onClick:c=>Q(l)},{default:a(()=>[...e[13]||(e[13]=[r("编辑",-1)])]),_:1},8,["onClick"]),t(i,{size:"small",type:"danger",onClick:c=>G(l)},{default:a(()=>[...e[14]||(e[14]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,V.value]]),t(W,{"current-page":w.value,"onUpdate:currentPage":e[0]||(e[0]=l=>w.value=l),"page-size":k.value,"onUpdate:pageSize":e[1]||(e[1]=l=>k.value=l),total:E.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:y,onCurrentChange:y,style:{"margin-top":"20px"}},null,8,["current-page","page-size","total"]),t(Y,{modelValue:m.value,"onUpdate:modelValue":e[10]||(e[10]=l=>m.value=l),title:x.value,width:"500px"},{footer:a(()=>[t(i,{onClick:e[9]||(e[9]=l=>m.value=!1)},{default:a(()=>[...e[19]||(e[19]=[r("取消",-1)])]),_:1}),t(i,{type:"primary",onClick:J},{default:a(()=>[...e[20]||(e[20]=[r("确定",-1)])]),_:1})]),default:a(()=>[t(X,{model:s,rules:F,ref_key:"formRef",ref:U,"label-width":"80px"},{default:a(()=>[t(p,{label:"用户名",prop:"username"},{default:a(()=>[t(z,{modelValue:s.username,"onUpdate:modelValue":e[2]||(e[2]=l=>s.username=l)},null,8,["modelValue"])]),_:1}),t(p,{label:"密码",prop:"password"},{default:a(()=>[t(z,{modelValue:s.password,"onUpdate:modelValue":e[3]||(e[3]=l=>s.password=l),type:"password"},null,8,["modelValue"])]),_:1}),t(p,{label:"邮箱",prop:"email"},{default:a(()=>[t(z,{modelValue:s.email,"onUpdate:modelValue":e[4]||(e[4]=l=>s.email=l)},null,8,["modelValue"])]),_:1}),t(p,{label:"角色",prop:"role_id"},{default:a(()=>[t(M,{modelValue:s.role_id,"onUpdate:modelValue":e[5]||(e[5]=l=>s.role_id=l),placeholder:"请选择角色"},{default:a(()=>[(_(!0),C(N,null,O(T.value,l=>(_(),$(q,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"所属部门",prop:"department_id"},{default:a(()=>[t(M,{modelValue:s.department_id,"onUpdate:modelValue":e[6]||(e[6]=l=>s.department_id=l),placeholder:"请选择部门"},{default:a(()=>[(_(!0),C(N,null,O(D.value,l=>(_(),$(q,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"员工类型",prop:"employee_type"},{default:a(()=>[t(R,{modelValue:s.employee_type,"onUpdate:modelValue":e[7]||(e[7]=l=>s.employee_type=l)},{default:a(()=>[t(v,{value:"internal"},{default:a(()=>[...e[15]||(e[15]=[r("内部员工",-1)])]),_:1}),t(v,{value:"external"},{default:a(()=>[...e[16]||(e[16]=[r("外部员工",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"状态",prop:"status"},{default:a(()=>[t(R,{modelValue:s.status,"onUpdate:modelValue":e[8]||(e[8]=l=>s.status=l)},{default:a(()=>[t(v,{value:1},{default:a(()=>[...e[17]||(e[17]=[r("正常",-1)])]),_:1}),t(v,{value:0},{default:a(()=>[...e[18]||(e[18]=[r("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},_e=se(ue,[["__scopeId","data-v-8cf6f94e"]]);export{_e as default};
