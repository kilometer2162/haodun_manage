import{r,b as K,m as L,d as U,o as _,e as $,M as Q,f as l,g as o,h as n,a2 as G,p as B,H as f,E as p,k as m,t as J,K as W,Q as X,R as Y,a3 as Z}from"./index-BI8oO-SX.js";import{f as h}from"./date-B59vURDm.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={class:"permissions-page"},le={class:"page-header"},te={__name:"Permissions",setup(oe){const E=h,v=r(!1),C=r([]),z=r([]),b=r(1),y=r(10),w=r(0),u=r(!1),V=r("新增权限"),k=r(null),s=K({id:null,name:"",code:"",description:"",resource_id:null}),S={name:[{required:!0,message:"请输入权限名",trigger:"blur"}],code:[{required:!0,message:"请输入权限代码",trigger:"blur"}],resource_id:[{required:!0,message:"请选择资源",trigger:"change"}]},c=async()=>{v.value=!0;try{const t=await f.get(`/permissions?page=${b.value}&page_size=${y.value}`);C.value=t.data.data,w.value=t.data.total}catch{p.error("加载权限列表失败")}finally{v.value=!1}},j=async()=>{try{const t=await f.get("/resources?page=1&page_size=1000");z.value=t.data.data}catch(t){console.error("加载资源列表失败",t)}},D=()=>{V.value="新增权限",Object.assign(s,{id:null,name:"",code:"",description:"",resource_id:null}),u.value=!0},M=t=>{V.value="编辑权限",Object.assign(s,{id:t.id,name:t.name,code:t.code,description:t.description,resource_id:t.resource_id}),u.value=!0},P=async t=>{try{await Z.confirm("确定要删除该权限吗？","提示",{type:"warning"}),await f.delete(`/permissions/${t.id}`),p.success("删除成功"),c()}catch(e){e!=="cancel"&&p.error("删除失败")}},R=async()=>{k.value&&await k.value.validate(async t=>{var e,i;if(t)try{s.id?(await f.put(`/permissions/${s.id}`,s),p.success("更新成功")):(await f.post("/permissions",s),p.success("创建成功")),u.value=!1,c()}catch(d){p.error(((i=(e=d.response)==null?void 0:e.data)==null?void 0:i.error)||"操作失败")}})};return L(()=>{c(),j()}),(t,e)=>{const i=n("el-button"),d=n("el-table-column"),T=n("el-table"),q=n("el-pagination"),x=n("el-input"),g=n("el-form-item"),N=n("el-option"),O=n("el-select"),A=n("el-form"),F=n("el-dialog"),H=G("loading");return _(),U("div",ae,[$("div",le,[e[9]||(e[9]=$("h2",null,"权限管理",-1)),l(i,{type:"primary",onClick:D},{default:o(()=>[...e[8]||(e[8]=[m("新增权限",-1)])]),_:1})]),Q((_(),B(T,{data:C.value,style:{"margin-top":"20px"}},{default:o(()=>[l(d,{prop:"name",label:"权限名",width:"160"}),l(d,{prop:"code",label:"权限代码"}),l(d,{prop:"description",label:"描述"}),l(d,{prop:"resource.name",label:"资源"}),l(d,{prop:"created_at",label:"创建时间",width:"180"},{default:o(({row:a})=>[m(J(W(E)(a.created_at)),1)]),_:1}),l(d,{label:"操作",width:"200"},{default:o(({row:a})=>[l(i,{size:"small",onClick:I=>M(a)},{default:o(()=>[...e[10]||(e[10]=[m("编辑",-1)])]),_:1},8,["onClick"]),l(i,{size:"small",type:"danger",onClick:I=>P(a)},{default:o(()=>[...e[11]||(e[11]=[m("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[H,v.value]]),l(q,{"current-page":b.value,"onUpdate:currentPage":e[0]||(e[0]=a=>b.value=a),"page-size":y.value,"onUpdate:pageSize":e[1]||(e[1]=a=>y.value=a),total:w.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:c,onCurrentChange:c,style:{"margin-top":"20px"}},null,8,["current-page","page-size","total"]),l(F,{modelValue:u.value,"onUpdate:modelValue":e[7]||(e[7]=a=>u.value=a),title:V.value,width:"500px"},{footer:o(()=>[l(i,{onClick:e[6]||(e[6]=a=>u.value=!1)},{default:o(()=>[...e[12]||(e[12]=[m("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:R},{default:o(()=>[...e[13]||(e[13]=[m("确定",-1)])]),_:1})]),default:o(()=>[l(A,{model:s,rules:S,ref_key:"formRef",ref:k,"label-width":"80px"},{default:o(()=>[l(g,{label:"权限名",prop:"name"},{default:o(()=>[l(x,{modelValue:s.name,"onUpdate:modelValue":e[2]||(e[2]=a=>s.name=a)},null,8,["modelValue"])]),_:1}),l(g,{label:"权限代码",prop:"code"},{default:o(()=>[l(x,{modelValue:s.code,"onUpdate:modelValue":e[3]||(e[3]=a=>s.code=a)},null,8,["modelValue"])]),_:1}),l(g,{label:"描述",prop:"description"},{default:o(()=>[l(x,{modelValue:s.description,"onUpdate:modelValue":e[4]||(e[4]=a=>s.description=a),type:"textarea"},null,8,["modelValue"])]),_:1}),l(g,{label:"资源",prop:"resource_id"},{default:o(()=>[l(O,{modelValue:s.resource_id,"onUpdate:modelValue":e[5]||(e[5]=a=>s.resource_id=a),placeholder:"请选择资源"},{default:o(()=>[(_(!0),U(X,null,Y(z.value,a=>(_(),B(N,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ie=ee(te,[["__scopeId","data-v-cbc9a1ef"]]);export{ie as default};
