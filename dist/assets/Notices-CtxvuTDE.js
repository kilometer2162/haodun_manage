import{r as u,b as F,m as ae,l as oe,d as I,o as _,e as k,f as t,M as ne,g as l,h as s,a2 as se,p as w,H as c,E as m,i as ie,k as o,j as re,t as C,K as J,J as O,a3 as de}from"./index-BI8oO-SX.js";import{f as ue}from"./date-B59vURDm.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const me={class:"notices-page"},fe={class:"page-header"},_e={key:0},ce={style:{margin:"10px 0",color:"#909399","font-size":"12px"}},ve=["innerHTML"],ge={__name:"Notices",setup(ye){const B=oe();ie();const z=u(!1),S=u([]),$=u(1),U=u(10),T=u(0),v=u(!1),N=u(!1),D=u("新增公告"),g=u(null),M=u(null),r=F({title:"",is_read:""}),i=F({id:null,title:"",content:"",priority:0,status:1}),P={title:[{required:!0,message:"请输入标题",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}]},R=ue,p=async()=>{z.value=!0;try{let n=`/notices?page=${$.value}&page_size=${U.value}`;r.title&&(n+=`&title=${r.title}`),r.is_read!==""&&(n+=`&is_read=${r.is_read}`);const e=await c.get(n);S.value=e.data.data||[],T.value=e.data.total}catch{m.error("加载消息列表失败")}finally{z.value=!1}},G=()=>{r.title="",r.is_read="",p()},Q=()=>{D.value="新增公告",Object.assign(i,{id:null,title:"",content:"",priority:0,status:1}),v.value=!0},j=async n=>{try{const e=await c.get(`/notices/${n.id}`);g.value=e.data,N.value=!0,n.is_read!==1&&await q(n)}catch{m.error("加载消息详情失败")}},q=async n=>{try{await c.put(`/notices/${n.id}/read`),n.is_read=1,m.success("标记已读成功"),p()}catch{m.error("标记已读失败")}},W=async n=>{try{await de.confirm("确定要删除该消息吗？","提示",{type:"warning"}),await c.delete(`/notices/${n.id}`),m.success("删除成功"),p()}catch(e){e!=="cancel"&&m.error("删除失败")}},X=async()=>{M.value&&await M.value.validate(async n=>{var e,d;if(n)try{i.id?(await c.put(`/notices/${i.id}`,i),m.success("更新成功")):(await c.post("/notices",i),m.success("创建成功")),v.value=!1,p()}catch(y){m.error(((d=(e=y.response)==null?void 0:e.data)==null?void 0:d.error)||"操作失败")}})};return ae(()=>{p(),B.query.id&&j({id:B.query.id})}),(n,e)=>{const d=s("el-button"),y=s("el-input"),f=s("el-form-item"),E=s("el-option"),Y=s("el-select"),H=s("el-form"),Z=s("el-card"),V=s("el-table-column"),x=s("el-tag"),h=s("el-table"),ee=s("el-pagination"),te=s("el-divider"),K=s("el-dialog"),b=s("el-radio"),L=s("el-radio-group"),le=se("loading");return _(),I("div",me,[k("div",fe,[e[12]||(e[12]=k("h2",null,"消息公告",-1)),t(d,{type:"primary",onClick:Q},{default:l(()=>[...e[11]||(e[11]=[o("新增公告",-1)])]),_:1})]),t(Z,{style:{"margin-top":"20px"}},{default:l(()=>[t(H,{inline:!0,model:r,class:"search-form"},{default:l(()=>[t(f,{label:"标题"},{default:l(()=>[t(y,{modelValue:r.title,"onUpdate:modelValue":e[0]||(e[0]=a=>r.title=a),placeholder:"请输入标题",clearable:"",style:{width:"200px"},onKeyup:re(p,["enter"])},null,8,["modelValue"])]),_:1}),t(f,{label:"阅读状态"},{default:l(()=>[t(Y,{modelValue:r.is_read,"onUpdate:modelValue":e[1]||(e[1]=a=>r.is_read=a),placeholder:"请选择",clearable:"",style:{width:"150px"}},{default:l(()=>[t(E,{label:"未读",value:"0"}),t(E,{label:"已读",value:"1"})]),_:1},8,["modelValue"])]),_:1}),t(f,null,{default:l(()=>[t(d,{type:"primary",onClick:p},{default:l(()=>[...e[13]||(e[13]=[o("搜索",-1)])]),_:1}),t(d,{onClick:G},{default:l(()=>[...e[14]||(e[14]=[o("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),ne((_(),w(h,{data:S.value,style:{"margin-top":"20px"}},{default:l(()=>[t(V,{prop:"title",label:"标题","min-width":"200"}),t(V,{label:"优先级",width:"100"},{default:l(({row:a})=>[a.priority===2?(_(),w(x,{key:0,type:"danger"},{default:l(()=>[...e[15]||(e[15]=[o("紧急",-1)])]),_:1})):a.priority===1?(_(),w(x,{key:1,type:"warning"},{default:l(()=>[...e[16]||(e[16]=[o("重要",-1)])]),_:1})):(_(),w(x,{key:2,type:"info"},{default:l(()=>[...e[17]||(e[17]=[o("普通",-1)])]),_:1}))]),_:1}),t(V,{label:"阅读状态",width:"100"},{default:l(({row:a})=>[t(x,{type:a.is_read===1?"success":"danger"},{default:l(()=>[o(C(a.is_read===1?"已读":"未读"),1)]),_:2},1032,["type"])]),_:1}),t(V,{prop:"created_at",label:"发布时间",width:"180"},{default:l(({row:a})=>[o(C(J(R)(a.created_at)),1)]),_:1}),t(V,{label:"操作",width:"200"},{default:l(({row:a})=>[t(d,{size:"small",onClick:A=>j(a)},{default:l(()=>[...e[18]||(e[18]=[o("查看",-1)])]),_:1},8,["onClick"]),a.is_read!==1?(_(),w(d,{key:0,size:"small",type:"success",onClick:A=>q(a)},{default:l(()=>[...e[19]||(e[19]=[o(" 标记已读 ",-1)])]),_:1},8,["onClick"])):O("",!0),t(d,{size:"small",type:"danger",onClick:A=>W(a)},{default:l(()=>[...e[20]||(e[20]=[o("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,z.value]]),t(ee,{"current-page":$.value,"onUpdate:currentPage":e[2]||(e[2]=a=>$.value=a),"page-size":U.value,"onUpdate:pageSize":e[3]||(e[3]=a=>U.value=a),total:T.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:p,onCurrentChange:p,style:{"margin-top":"20px"}},null,8,["current-page","page-size","total"]),t(K,{modelValue:N.value,"onUpdate:modelValue":e[4]||(e[4]=a=>N.value=a),title:"消息详情",width:"800px"},{default:l(()=>[g.value?(_(),I("div",_e,[k("h3",null,C(g.value.title),1),k("div",ce," 发布时间："+C(J(R)(g.value.created_at)),1),t(te),k("div",{class:"notice-content",innerHTML:g.value.content},null,8,ve)])):O("",!0)]),_:1},8,["modelValue"]),t(K,{modelValue:v.value,"onUpdate:modelValue":e[10]||(e[10]=a=>v.value=a),title:D.value,width:"600px"},{footer:l(()=>[t(d,{onClick:e[9]||(e[9]=a=>v.value=!1)},{default:l(()=>[...e[26]||(e[26]=[o("取消",-1)])]),_:1}),t(d,{type:"primary",onClick:X},{default:l(()=>[...e[27]||(e[27]=[o("确定",-1)])]),_:1})]),default:l(()=>[t(H,{model:i,rules:P,ref_key:"formRef",ref:M,"label-width":"100px"},{default:l(()=>[t(f,{label:"标题",prop:"title"},{default:l(()=>[t(y,{modelValue:i.title,"onUpdate:modelValue":e[5]||(e[5]=a=>i.title=a),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),t(f,{label:"内容",prop:"content"},{default:l(()=>[t(y,{modelValue:i.content,"onUpdate:modelValue":e[6]||(e[6]=a=>i.content=a),type:"textarea",rows:6,placeholder:"请输入内容"},null,8,["modelValue"])]),_:1}),t(f,{label:"优先级",prop:"priority"},{default:l(()=>[t(L,{modelValue:i.priority,"onUpdate:modelValue":e[7]||(e[7]=a=>i.priority=a)},{default:l(()=>[t(b,{value:0},{default:l(()=>[...e[21]||(e[21]=[o("普通",-1)])]),_:1}),t(b,{value:1},{default:l(()=>[...e[22]||(e[22]=[o("重要",-1)])]),_:1}),t(b,{value:2},{default:l(()=>[...e[23]||(e[23]=[o("紧急",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"状态",prop:"status"},{default:l(()=>[t(L,{modelValue:i.status,"onUpdate:modelValue":e[8]||(e[8]=a=>i.status=a)},{default:l(()=>[t(b,{value:1},{default:l(()=>[...e[24]||(e[24]=[o("发布",-1)])]),_:1}),t(b,{value:0},{default:l(()=>[...e[25]||(e[25]=[o("草稿",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},we=pe(ge,[["__scopeId","data-v-8d6dea1b"]]);export{we as default};
