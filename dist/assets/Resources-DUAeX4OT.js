import{r as u,b as ae,c as oe,m as ne,d as b,o as m,e as f,M as I,f as t,g as a,h as r,a2 as se,p as O,H as x,E as V,k as i,t as k,J as re,a3 as de}from"./index-BI8oO-SX.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";const pe={class:"resources-page"},ue={class:"page-header"},me={class:"tree-node"},ce={class:"tree-node-label"},_e={key:0,style:{"margin-right":"4px",color:"#409eff"}},ge={key:1,style:{"margin-right":"4px",color:"#67c23a"}},fe={key:2,style:{"margin-right":"4px",color:"#909399"}},ye={style:{"margin-left":"8px",color:"#909399","font-size":"12px"}},ve={class:"tree-node-actions"},be={key:1},he={key:0},Ve={key:1,style:{color:"#909399"}},ke={__name:"Resources",setup(xe){const C=u(!1),E=u("tree"),M=u([]),U=u([]),w=u(1),D=u(10),R=u(0),y=u(!1),z=u("æ–°å¢èµ„æº"),$=u(null),P=u(null),n=ae({id:null,name:"",path:"",method:"",type:"",description:"",parent_id:null,sort:0,icon:""}),L={name:[{required:!0,message:"è¯·è¾“å…¥èµ„æºå",trigger:"blur"}],path:[{required:!0,message:"è¯·è¾“å…¥è·¯å¾„",trigger:"blur"}],method:[{required:!0,message:"è¯·é€‰æ‹©æ–¹æ³•",trigger:"change"}],type:[{required:!0,message:"è¯·é€‰æ‹©ç±»å‹",trigger:"change"}]},H=oe(()=>{const o=(e,p=null)=>e.filter(s=>s.id!==p).map(s=>({id:s.id,name:s.name,children:s.children&&s.children.length>0?o(s.children,p):[]}));return o(U.value,n.id)}),B=o=>({GET:"success",POST:"primary",PUT:"warning",DELETE:"danger"})[o]||"",h=async()=>{C.value=!0;try{if(E.value==="tree"){const o=await x.get("/resources?tree=true");U.value=o.data.data||[]}else{const o=await x.get(`/resources?page=${w.value}&page_size=${D.value}`);M.value=o.data.data||[],R.value=o.data.total||0}}catch{V.error("åŠ è½½èµ„æºåˆ—è¡¨å¤±è´¥")}finally{C.value=!1}},J=()=>{h()},F=()=>{z.value="æ–°å¢èµ„æº",P.value=null,Object.assign(n,{id:null,name:"",path:"",method:"",type:"",description:"",parent_id:null,sort:0,icon:""}),y.value=!0},K=o=>{z.value="æ–°å¢å­èµ„æº",P.value=o.id,Object.assign(n,{id:null,name:"",path:"",method:"",type:"",description:"",parent_id:o.id,sort:0,icon:""}),y.value=!0},j=o=>{z.value="ç¼–è¾‘èµ„æº",P.value=null,Object.assign(n,{id:o.id,name:o.name,path:o.path,method:o.method,type:o.type,description:o.description||"",parent_id:o.parent_id||null,sort:o.sort||0,icon:o.icon||""}),y.value=!0},q=async o=>{var e,p;try{await de.confirm("ç¡®å®šè¦åˆ é™¤è¯¥èµ„æºå—ï¼Ÿåˆ é™¤åå…¶å­èµ„æºä¹Ÿä¼šè¢«åˆ é™¤ã€‚","æç¤º",{type:"warning"}),await x.delete(`/resources/${o.id}`),V.success("åˆ é™¤æˆåŠŸ"),h()}catch(s){s!=="cancel"&&V.error(((p=(e=s.response)==null?void 0:e.data)==null?void 0:p.error)||"åˆ é™¤å¤±è´¥")}},Q=async()=>{$.value&&await $.value.validate(async o=>{var e,p;if(o)try{const s={...n,parent_id:n.parent_id||null};n.id?(await x.put(`/resources/${n.id}`,s),V.success("æ›´æ–°æˆåŠŸ")):(await x.post("/resources",s),V.success("åˆ›å»ºæˆåŠŸ")),y.value=!1,h()}catch(s){V.error(((p=(e=s.response)==null?void 0:e.data)==null?void 0:p.error)||"æ“ä½œå¤±è´¥")}})};return ne(()=>{h()}),(o,e)=>{const p=r("el-radio-button"),s=r("el-radio-group"),c=r("el-button"),S=r("el-tag"),W=r("el-tree"),_=r("el-table-column"),X=r("el-table"),Y=r("el-pagination"),T=r("el-input"),g=r("el-form-item"),v=r("el-option"),N=r("el-select"),Z=r("el-cascader"),ee=r("el-input-number"),te=r("el-form"),le=r("el-dialog"),A=se("loading");return m(),b("div",pe,[f("div",ue,[e[16]||(e[16]=f("h2",null,"èµ„æºç®¡ç†",-1)),f("div",null,[t(s,{modelValue:E.value,"onUpdate:modelValue":e[0]||(e[0]=l=>E.value=l),onChange:J,style:{"margin-right":"10px"}},{default:a(()=>[t(p,{value:"tree"},{default:a(()=>[...e[13]||(e[13]=[i("æ ‘å½¢è§†å›¾",-1)])]),_:1}),t(p,{value:"list"},{default:a(()=>[...e[14]||(e[14]=[i("åˆ—è¡¨è§†å›¾",-1)])]),_:1})]),_:1},8,["modelValue"]),t(c,{type:"primary",onClick:F},{default:a(()=>[...e[15]||(e[15]=[i("æ–°å¢èµ„æº",-1)])]),_:1})])]),E.value==="tree"?I((m(),O(W,{key:0,data:U.value,props:{children:"children",label:"name"},"node-key":"id","default-expand-all":"",style:{"margin-top":"20px",background:"#fff",padding:"20px"}},{default:a(({node:l,data:d})=>[f("span",me,[f("span",ce,[d.type==="menu"?(m(),b("span",_e,"ğŸ“")):d.type==="button"?(m(),b("span",ge,"ğŸ”˜")):(m(),b("span",fe,"ğŸ”—")),f("span",null,k(d.name),1),t(S,{size:"small",type:B(d.method),style:{"margin-left":"8px"}},{default:a(()=>[i(k(d.method),1)]),_:2},1032,["type"]),t(S,{size:"small",type:"info",style:{"margin-left":"4px"}},{default:a(()=>[i(k(d.type),1)]),_:2},1024),f("span",ye,k(d.path),1)]),f("span",ve,[d.type==="menu"?(m(),O(c,{key:0,size:"small",text:"",type:"primary",onClick:G=>K(d)},{default:a(()=>[...e[17]||(e[17]=[i("æ·»åŠ å­é¡¹",-1)])]),_:1},8,["onClick"])):re("",!0),t(c,{size:"small",text:"",onClick:G=>j(d)},{default:a(()=>[...e[18]||(e[18]=[i("ç¼–è¾‘",-1)])]),_:1},8,["onClick"]),t(c,{size:"small",text:"",type:"danger",onClick:G=>q(d)},{default:a(()=>[...e[19]||(e[19]=[i("åˆ é™¤",-1)])]),_:1},8,["onClick"])])])]),_:1},8,["data"])),[[A,C.value]]):(m(),b("div",be,[I((m(),O(X,{data:M.value,style:{"margin-top":"20px"}},{default:a(()=>[t(_,{prop:"name",label:"èµ„æºå"}),t(_,{prop:"path",label:"è·¯å¾„"}),t(_,{prop:"method",label:"æ–¹æ³•",width:"100"},{default:a(({row:l})=>[t(S,{type:B(l.method)},{default:a(()=>[i(k(l.method),1)]),_:2},1032,["type"])]),_:1}),t(_,{prop:"type",label:"ç±»å‹",width:"100"}),t(_,{prop:"parent_id",label:"çˆ¶èµ„æºID",width:"100"},{default:a(({row:l})=>[l.parent_id?(m(),b("span",he,k(l.parent_id),1)):(m(),b("span",Ve,"-"))]),_:1}),t(_,{prop:"sort",label:"æ’åº",width:"80"}),t(_,{prop:"description",label:"æè¿°"}),t(_,{label:"æ“ä½œ",width:"200"},{default:a(({row:l})=>[t(c,{size:"small",onClick:d=>j(l)},{default:a(()=>[...e[20]||(e[20]=[i("ç¼–è¾‘",-1)])]),_:1},8,["onClick"]),t(c,{size:"small",type:"danger",onClick:d=>q(l)},{default:a(()=>[...e[21]||(e[21]=[i("åˆ é™¤",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[A,C.value]]),t(Y,{"current-page":w.value,"onUpdate:currentPage":e[1]||(e[1]=l=>w.value=l),"page-size":D.value,"onUpdate:pageSize":e[2]||(e[2]=l=>D.value=l),total:R.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:h,onCurrentChange:h,style:{"margin-top":"20px"}},null,8,["current-page","page-size","total"])])),t(le,{modelValue:y.value,"onUpdate:modelValue":e[12]||(e[12]=l=>y.value=l),title:z.value,width:"600px"},{footer:a(()=>[t(c,{onClick:e[11]||(e[11]=l=>y.value=!1)},{default:a(()=>[...e[22]||(e[22]=[i("å–æ¶ˆ",-1)])]),_:1}),t(c,{type:"primary",onClick:Q},{default:a(()=>[...e[23]||(e[23]=[i("ç¡®å®š",-1)])]),_:1})]),default:a(()=>[t(te,{model:n,rules:L,ref_key:"formRef",ref:$,"label-width":"100px"},{default:a(()=>[t(g,{label:"èµ„æºå",prop:"name"},{default:a(()=>[t(T,{modelValue:n.name,"onUpdate:modelValue":e[3]||(e[3]=l=>n.name=l),placeholder:"è¯·è¾“å…¥èµ„æºå"},null,8,["modelValue"])]),_:1}),t(g,{label:"è·¯å¾„",prop:"path"},{default:a(()=>[t(T,{modelValue:n.path,"onUpdate:modelValue":e[4]||(e[4]=l=>n.path=l),placeholder:"è¯·è¾“å…¥è·¯å¾„ï¼Œå¦‚ï¼š/api/users"},null,8,["modelValue"])]),_:1}),t(g,{label:"æ–¹æ³•",prop:"method"},{default:a(()=>[t(N,{modelValue:n.method,"onUpdate:modelValue":e[5]||(e[5]=l=>n.method=l),placeholder:"è¯·é€‰æ‹©æ–¹æ³•",style:{width:"100%"}},{default:a(()=>[t(v,{label:"GET",value:"GET"}),t(v,{label:"POST",value:"POST"}),t(v,{label:"PUT",value:"PUT"}),t(v,{label:"DELETE",value:"DELETE"})]),_:1},8,["modelValue"])]),_:1}),t(g,{label:"ç±»å‹",prop:"type"},{default:a(()=>[t(N,{modelValue:n.type,"onUpdate:modelValue":e[6]||(e[6]=l=>n.type=l),placeholder:"è¯·é€‰æ‹©ç±»å‹",style:{width:"100%"}},{default:a(()=>[t(v,{label:"API",value:"api"}),t(v,{label:"èœå•",value:"menu"}),t(v,{label:"æŒ‰é’®",value:"button"})]),_:1},8,["modelValue"])]),_:1}),t(g,{label:"çˆ¶èµ„æº",prop:"parent_id"},{default:a(()=>[t(Z,{modelValue:n.parent_id,"onUpdate:modelValue":e[7]||(e[7]=l=>n.parent_id=l),options:H.value,props:{value:"id",label:"name",children:"children",checkStrictly:!0,emitPath:!1},placeholder:"è¯·é€‰æ‹©çˆ¶èµ„æºï¼ˆå¯é€‰ï¼‰",clearable:"",style:{width:"100%"},filterable:""},null,8,["modelValue","options"])]),_:1}),t(g,{label:"æ’åº",prop:"sort"},{default:a(()=>[t(ee,{modelValue:n.sort,"onUpdate:modelValue":e[8]||(e[8]=l=>n.sort=l),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(g,{label:"å›¾æ ‡",prop:"icon"},{default:a(()=>[t(T,{modelValue:n.icon,"onUpdate:modelValue":e[9]||(e[9]=l=>n.icon=l),placeholder:"è¯·è¾“å…¥å›¾æ ‡åç§°ï¼ˆå¯é€‰ï¼‰"},null,8,["modelValue"])]),_:1}),t(g,{label:"æè¿°",prop:"description"},{default:a(()=>[t(T,{modelValue:n.description,"onUpdate:modelValue":e[10]||(e[10]=l=>n.description=l),type:"textarea",rows:3,placeholder:"è¯·è¾“å…¥æè¿°"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ze=ie(ke,[["__scopeId","data-v-ced011ce"]]);export{ze as default};
