import{u as x,a as C,r as l,c as k,w as N,b as R,d as S,o as E,e as h,f as s,t as B,g as n,h as u,i as D,j as F,k as L,E as v}from"./index-BI8oO-SX.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";const q={class:"login-container"},z={class:"login-box"},A={__name:"Login",setup(I){const b=D(),i=x(),g=C(),d=l(null),c=l(!1);l(!1),l(""),l("");const _=k(()=>g.siteName||"管理系统");N(_,e=>{g.updateDocumentTitle(e)},{immediate:!0});const a=R({username:"",password:"",captchaCode:""}),y={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},w=async()=>{d.value&&await d.value.validate(async e=>{var t,r;if(e){c.value=!0;try{const o=await i.login(a.username,a.password);if(!o.success)throw new Error(o.error||"登录失败");await i.fetchUserInfo(),v.success("登录成功");const m=i.userPermissions,p=V(m);b.push(p)}catch(o){v.error(o.message||((r=(t=o.response)==null?void 0:t.data)==null?void 0:r.error)||"登录失败")}finally{c.value=!1}}})},V=e=>!e||e.length===0?"/":e.includes("menu:dashboard:view")?"/dashboard":e.includes("menu:orders:view")?"/orders":e.includes("menu:notices:view")?"/notices":e.includes("menu:dicts:view")?"/dicts":"/";return(e,t)=>{const r=u("el-input"),o=u("el-form-item"),m=u("el-button"),p=u("el-form");return E(),S("div",q,[h("div",z,[h("h2",null,B(_.value)+"系统",1),s(p,{model:a,rules:y,ref_key:"loginFormRef",ref:d,"label-width":"90px",size:"large"},{default:n(()=>[s(o,{label:"用户名",prop:"username"},{default:n(()=>[s(r,{modelValue:a.username,"onUpdate:modelValue":t[0]||(t[0]=f=>a.username=f),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),s(o,{label:"密码",prop:"password"},{default:n(()=>[s(r,{modelValue:a.password,"onUpdate:modelValue":t[1]||(t[1]=f=>a.password=f),type:"password",placeholder:"请输入密码",clearable:"",onKeyup:F(w,["enter"])},null,8,["modelValue"])]),_:1}),s(o,{class:"login-btn-item"},{default:n(()=>[s(m,{type:"primary",onClick:w,loading:c.value,style:{width:"100%"},size:"large",class:"login-btn"},{default:n(()=>[...t[2]||(t[2]=[L(" 登录 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])])}}},j=U(A,[["__scopeId","data-v-72d0e44a"]]);export{j as default};
