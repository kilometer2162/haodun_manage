import{r as n,b as X,m as Y,d as E,o as b,e as P,M as Z,f as t,g as a,h as d,a2 as h,p as j,H as f,E as u,k as i,t as y,K as ee,Q as le,R as te,a3 as ae}from"./index-BI8oO-SX.js";import{f as oe}from"./date-B59vURDm.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ne={class:"roles-page"},re={class:"page-header"},ie={__name:"Roles",setup(de){const M=oe,k=n(!1),z=n([]),$=n([]),V=n(1),x=n(10),R=n(0),m=n(!1),v=n(!1),C=n("新增角色"),U=n(null),_=n([]),w=n(null),r=X({id:null,name:"",description:""}),T={name:[{required:!0,message:"请输入角色名",trigger:"blur"}]},c=async()=>{k.value=!0;try{const o=await f.get(`/roles?page=${V.value}&page_size=${x.value}`);z.value=o.data.data,R.value=o.data.total}catch{u.error("加载角色列表失败")}finally{k.value=!1}},N=async()=>{try{const o=await f.get("/permissions?page=1&page_size=1000");$.value=o.data.data}catch(o){console.error("加载权限列表失败",o)}},A=()=>{C.value="新增角色",Object.assign(r,{id:null,name:"",description:""}),m.value=!0},I=o=>{C.value="编辑角色",Object.assign(r,{id:o.id,name:o.name,description:o.description}),m.value=!0},O=o=>{var e;U.value=o.id,_.value=((e=o.permissions)==null?void 0:e.map(s=>s.id))||[],v.value=!0},q=async o=>{try{await ae.confirm("确定要删除该角色吗？","提示",{type:"warning"}),await f.delete(`/roles/${o.id}`),u.success("删除成功"),c()}catch(e){e!=="cancel"&&u.error("删除失败")}},F=async()=>{w.value&&await w.value.validate(async o=>{var e,s;if(o)try{r.id?(await f.put(`/roles/${r.id}`,r),u.success("更新成功")):(await f.post("/roles",r),u.success("创建成功")),m.value=!1,c()}catch(p){u.error(((s=(e=p.response)==null?void 0:e.data)==null?void 0:s.error)||"操作失败")}})},H=async()=>{try{await f.post(`/roles/${U.value}/permissions`,{permission_ids:_.value}),u.success("权限分配成功"),v.value=!1,c()}catch{u.error("权限分配失败")}};return Y(()=>{c(),N()}),(o,e)=>{const s=d("el-button"),p=d("el-table-column"),K=d("el-table"),L=d("el-pagination"),B=d("el-input"),S=d("el-form-item"),Q=d("el-form"),D=d("el-dialog"),G=d("el-checkbox"),J=d("el-checkbox-group"),W=h("loading");return b(),E("div",ne,[P("div",re,[e[10]||(e[10]=P("h2",null,"角色管理",-1)),t(s,{type:"primary",onClick:A},{default:a(()=>[...e[9]||(e[9]=[i("新增角色",-1)])]),_:1})]),Z((b(),j(K,{data:z.value,style:{"margin-top":"20px"}},{default:a(()=>[t(p,{prop:"name",label:"角色名",width:"160"}),t(p,{prop:"description",label:"描述"}),t(p,{label:"权限数量"},{default:a(({row:l})=>{var g;return[i(y(((g=l.permissions)==null?void 0:g.length)||0),1)]}),_:1}),t(p,{prop:"created_at",label:"创建时间",width:"180"},{default:a(({row:l})=>[i(y(ee(M)(l.created_at)),1)]),_:1}),t(p,{label:"操作",width:"250"},{default:a(({row:l})=>[t(s,{size:"small",onClick:g=>I(l)},{default:a(()=>[...e[11]||(e[11]=[i("编辑",-1)])]),_:1},8,["onClick"]),t(s,{size:"small",onClick:g=>O(l)},{default:a(()=>[...e[12]||(e[12]=[i("分配权限",-1)])]),_:1},8,["onClick"]),t(s,{size:"small",type:"danger",onClick:g=>q(l)},{default:a(()=>[...e[13]||(e[13]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[W,k.value]]),t(L,{"current-page":V.value,"onUpdate:currentPage":e[0]||(e[0]=l=>V.value=l),"page-size":x.value,"onUpdate:pageSize":e[1]||(e[1]=l=>x.value=l),total:R.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:c,onCurrentChange:c,style:{"margin-top":"20px"}},null,8,["current-page","page-size","total"]),t(D,{modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=l=>m.value=l),title:C.value,width:"500px"},{footer:a(()=>[t(s,{onClick:e[4]||(e[4]=l=>m.value=!1)},{default:a(()=>[...e[14]||(e[14]=[i("取消",-1)])]),_:1}),t(s,{type:"primary",onClick:F},{default:a(()=>[...e[15]||(e[15]=[i("确定",-1)])]),_:1})]),default:a(()=>[t(Q,{model:r,rules:T,ref_key:"formRef",ref:w,"label-width":"80px"},{default:a(()=>[t(S,{label:"角色名",prop:"name"},{default:a(()=>[t(B,{modelValue:r.name,"onUpdate:modelValue":e[2]||(e[2]=l=>r.name=l)},null,8,["modelValue"])]),_:1}),t(S,{label:"描述",prop:"description"},{default:a(()=>[t(B,{modelValue:r.description,"onUpdate:modelValue":e[3]||(e[3]=l=>r.description=l),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(D,{modelValue:v.value,"onUpdate:modelValue":e[8]||(e[8]=l=>v.value=l),title:"分配权限",width:"600px"},{footer:a(()=>[t(s,{onClick:e[7]||(e[7]=l=>v.value=!1)},{default:a(()=>[...e[16]||(e[16]=[i("取消",-1)])]),_:1}),t(s,{type:"primary",onClick:H},{default:a(()=>[...e[17]||(e[17]=[i("确定",-1)])]),_:1})]),default:a(()=>[t(J,{modelValue:_.value,"onUpdate:modelValue":e[6]||(e[6]=l=>_.value=l)},{default:a(()=>[(b(!0),E(le,null,te($.value,l=>(b(),j(G,{key:l.id,label:l.id},{default:a(()=>[i(y(l.name)+" ("+y(l.code)+") ",1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])])}}},ce=se(ie,[["__scopeId","data-v-8d6ae2d7"]]);export{ce as default};
