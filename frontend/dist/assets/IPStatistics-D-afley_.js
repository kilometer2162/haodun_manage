import{r as i,b as q,w as G,m as J,d as K,o as S,e as f,f as e,g as a,h as r,H as k,E as C,a2 as L,M as Q,k as d,p as W,t as p}from"./index-BI8oO-SX.js";import{f as B}from"./date-B59vURDm.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"ip-statistics-page"},$={__name:"IPStatistics",setup(ee){const T=o=>o?B(o):"",Y=o=>o?B(o,"YYYY-MM-DD"):"",b=i("accesses"),v=i(!1),w=i([]),D=i([]),M=i([]),_=i(1),g=i(10),h=i(0),s=q({ip:"",country:"",province:"",city:"",start_date:"",end_date:""}),m=async()=>{v.value=!0;try{const o={page:_.value,page_size:g.value,...s};Object.keys(o).forEach(u=>{(o[u]===""||o[u]===null)&&delete o[u]});const l=await k.get("/ip-accesses",{params:o});w.value=l.data.data,h.value=l.data.total}catch{C.error("加载IP访问记录失败")}finally{v.value=!1}},j=async()=>{try{const o=await k.get("/ip-statistics");D.value=o.data.date_stats,M.value=o.data.region_stats}catch{C.error("加载统计信息失败")}},I=()=>{_.value=1,m()},E=()=>{Object.assign(s,{ip:"",country:"",province:"",city:"",start_date:"",end_date:""}),I()};return G(b,o=>{o==="statistics"&&j()}),J(()=>{m()}),(o,l)=>{const u=r("el-input"),c=r("el-form-item"),P=r("el-date-picker"),x=r("el-button"),N=r("el-form"),y=r("el-card"),n=r("el-table-column"),A=r("el-tag"),V=r("el-table"),O=r("el-pagination"),U=r("el-tab-pane"),z=r("el-col"),F=r("el-row"),H=r("el-tabs"),R=L("loading");return S(),K("div",Z,[l[13]||(l[13]=f("div",{class:"page-header"},[f("h2",null,"IP访问统计")],-1)),e(H,{modelValue:b.value,"onUpdate:modelValue":l[8]||(l[8]=t=>b.value=t),style:{"margin-top":"20px"}},{default:a(()=>[e(U,{label:"访问记录",name:"accesses"},{default:a(()=>[e(y,null,{default:a(()=>[e(N,{inline:!0,model:s,class:"search-form"},{default:a(()=>[e(c,{label:"IP地址"},{default:a(()=>[e(u,{modelValue:s.ip,"onUpdate:modelValue":l[0]||(l[0]=t=>s.ip=t),placeholder:"请输入IP地址",clearable:""},null,8,["modelValue"])]),_:1}),e(c,{label:"国家"},{default:a(()=>[e(u,{modelValue:s.country,"onUpdate:modelValue":l[1]||(l[1]=t=>s.country=t),placeholder:"请输入国家",clearable:""},null,8,["modelValue"])]),_:1}),e(c,{label:"省份"},{default:a(()=>[e(u,{modelValue:s.province,"onUpdate:modelValue":l[2]||(l[2]=t=>s.province=t),placeholder:"请输入省份",clearable:""},null,8,["modelValue"])]),_:1}),e(c,{label:"城市"},{default:a(()=>[e(u,{modelValue:s.city,"onUpdate:modelValue":l[3]||(l[3]=t=>s.city=t),placeholder:"请输入城市",clearable:""},null,8,["modelValue"])]),_:1}),e(c,{label:"开始日期"},{default:a(()=>[e(P,{modelValue:s.start_date,"onUpdate:modelValue":l[4]||(l[4]=t=>s.start_date=t),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",clearable:""},null,8,["modelValue"])]),_:1}),e(c,{label:"结束日期"},{default:a(()=>[e(P,{modelValue:s.end_date,"onUpdate:modelValue":l[5]||(l[5]=t=>s.end_date=t),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",clearable:""},null,8,["modelValue"])]),_:1}),e(c,null,{default:a(()=>[e(x,{type:"primary",onClick:I},{default:a(()=>[...l[9]||(l[9]=[d("搜索",-1)])]),_:1}),e(x,{onClick:E},{default:a(()=>[...l[10]||(l[10]=[d("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),Q((S(),W(V,{data:w.value,style:{"margin-top":"20px"}},{default:a(()=>[e(n,{prop:"ip",label:"IP地址",width:"150"}),e(n,{prop:"date",label:"日期",width:"120"},{default:a(({row:t})=>[d(p(t.date?Y(t.date):""),1)]),_:1}),e(n,{prop:"country",label:"国家",width:"100"},{default:a(({row:t})=>[d(p(t.country||"未知"),1)]),_:1}),e(n,{prop:"province",label:"省份",width:"120"},{default:a(({row:t})=>[d(p(t.province||"未知"),1)]),_:1}),e(n,{prop:"city",label:"城市",width:"120"},{default:a(({row:t})=>[d(p(t.city||"未知"),1)]),_:1}),e(n,{prop:"isp",label:"运营商",width:"120"}),e(n,{prop:"access_count",label:"访问次数",width:"120"},{default:a(({row:t})=>[e(A,{type:"primary"},{default:a(()=>[d(p(t.access_count),1)]),_:2},1024)]),_:1}),e(n,{prop:"created_at",label:"创建时间",width:"180"},{default:a(({row:t})=>[d(p(t.created_at?T(t.created_at):""),1)]),_:1})]),_:1},8,["data"])),[[R,v.value]]),e(O,{"current-page":_.value,"onUpdate:currentPage":l[6]||(l[6]=t=>_.value=t),"page-size":g.value,"onUpdate:pageSize":l[7]||(l[7]=t=>g.value=t),total:h.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:m,onCurrentChange:m,style:{"margin-top":"20px"}},null,8,["current-page","page-size","total"])]),_:1}),e(U,{label:"统计图表",name:"statistics"},{default:a(()=>[e(F,{gutter:20,style:{"margin-top":"20px"}},{default:a(()=>[e(z,{span:12},{default:a(()=>[e(y,null,{header:a(()=>[...l[11]||(l[11]=[f("span",null,"按日期统计（最近30天）",-1)])]),default:a(()=>[e(V,{data:D.value,style:{width:"100%"}},{default:a(()=>[e(n,{prop:"date",label:"日期"},{default:a(({row:t})=>[d(p(t.date?Y(t.date):""),1)]),_:1}),e(n,{prop:"access_count",label:"访问次数"}),e(n,{prop:"ip_count",label:"IP数量"})]),_:1},8,["data"])]),_:1})]),_:1}),e(z,{span:12},{default:a(()=>[e(y,null,{header:a(()=>[...l[12]||(l[12]=[f("span",null,"按地区统计（Top 50）",-1)])]),default:a(()=>[e(V,{data:M.value,style:{width:"100%"}},{default:a(()=>[e(n,{prop:"country",label:"国家",width:"100"},{default:a(({row:t})=>[d(p(t.country||"未知"),1)]),_:1}),e(n,{prop:"province",label:"省份",width:"120"},{default:a(({row:t})=>[d(p(t.province||"未知"),1)]),_:1}),e(n,{prop:"city",label:"城市",width:"120"},{default:a(({row:t})=>[d(p(t.city||"未知"),1)]),_:1}),e(n,{prop:"access_count",label:"访问次数"}),e(n,{prop:"ip_count",label:"IP数量"})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},oe=X($,[["__scopeId","data-v-37212d0b"]]);export{oe as default};
