import{r as p,b as Y,m as Z,d as R,o as m,e as B,M as h,f as t,g as o,h as r,a2 as ee,p as y,H as k,E as _,Q as le,R as te,k as i,t as D,K as ae,a3 as oe}from"./index-BI8oO-SX.js";import{f as ue}from"./date-B59vURDm.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";const se={class:"configs-page"},re={class:"page-header"},de={__name:"Configs",setup(pe){const T=ue,U=p(!1),V=p([]),E=p([]),x=p(""),w=p(1),z=p(10),C=p(0),b=p(!1),$=p("新增参数"),S=p(null),a=Y({id:null,key:"",label:"",value:"",type:"text",group:"system",sort:0,status:1,description:""}),A={key:[{required:!0,message:"请输入参数键",trigger:"blur"}],label:[{required:!0,message:"请输入参数标签",trigger:"blur"}]},c=async()=>{var u,e;U.value=!0;try{let s=`/configs?page=${w.value}&page_size=${z.value}`;x.value&&(s+=`&group=${encodeURIComponent(x.value)}`);const n=await k.get(s);n.data&&n.data.data?(V.value=n.data.data,C.value=n.data.total||0):(V.value=Array.isArray(n.data)?n.data:[],C.value=V.value.length)}catch(s){console.error("加载参数列表失败:",s),_.error(((e=(u=s.response)==null?void 0:u.data)==null?void 0:e.error)||"加载参数列表失败"),V.value=[],C.value=0}finally{U.value=!1}},q=async()=>{try{const u=await k.get("/configs/groups");E.value=u.data.groups}catch(u){console.error("加载分组列表失败",u)}},G=()=>{$.value="新增参数",Object.assign(a,{id:null,key:"",label:"",value:"",type:"text",group:"system",sort:0,status:1,description:""}),b.value=!0},I=u=>{$.value="编辑参数";let e=u.value;u.type==="boolean"?e=u.value==="true"||u.value==="1"||u.value===!0:u.type==="number"&&(e=Number(u.value)||0),Object.assign(a,{id:u.id,key:u.key,label:u.label,value:e,type:u.type,group:u.group,sort:u.sort,status:u.status,description:u.description}),b.value=!0},O=async u=>{try{await oe.confirm("确定要删除该参数吗？","提示",{type:"warning"}),await k.delete(`/configs/${u.id}`),_.success("删除成功"),c()}catch(e){e!=="cancel"&&_.error("删除失败")}},F=async()=>{S.value&&await S.value.validate(async u=>{var e,s;if(u)try{let n=a.value;a.type==="boolean"?n=n?"1":"0":a.type==="number"?n=String(n):n=String(n||"");const v={...a,value:n};a.id?(await k.put(`/configs/${a.id}`,v),_.success("更新成功")):(await k.post("/configs",v),_.success("创建成功")),b.value=!1,c()}catch(n){_.error(((s=(e=n.response)==null?void 0:e.data)==null?void 0:s.error)||"操作失败")}})};return Z(()=>{c(),q()}),(u,e)=>{const s=r("el-option"),n=r("el-select"),v=r("el-button"),d=r("el-table-column"),j=r("el-tag"),H=r("el-table"),K=r("el-pagination"),g=r("el-input"),f=r("el-form-item"),M=r("el-input-number"),L=r("el-switch"),N=r("el-radio"),P=r("el-radio-group"),Q=r("el-form"),J=r("el-dialog"),W=ee("loading");return m(),R("div",se,[B("div",re,[e[18]||(e[18]=B("h2",null,"系统参数管理",-1)),B("div",null,[t(n,{modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=l=>x.value=l),placeholder:"选择分组",clearable:"",onChange:c,style:{width:"200px","margin-right":"10px"}},{default:o(()=>[(m(!0),R(le,null,te(E.value,l=>(m(),y(s,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(v,{type:"primary",onClick:G},{default:o(()=>[...e[17]||(e[17]=[i("新增参数",-1)])]),_:1})])]),h((m(),y(H,{data:V.value,style:{"margin-top":"20px"}},{default:o(()=>[t(d,{prop:"key",label:"参数键",width:"200"}),t(d,{prop:"label",label:"参数标签"}),t(d,{prop:"value",label:"参数值","show-overflow-tooltip":""}),t(d,{prop:"type",label:"类型",width:"100"},{default:o(({row:l})=>[t(j,{size:"small"},{default:o(()=>[i(D(l.type),1)]),_:2},1024)]),_:1}),t(d,{prop:"group",label:"分组",width:"120"}),t(d,{prop:"sort",label:"排序",width:"80"}),t(d,{label:"状态",width:"100"},{default:o(({row:l})=>[t(j,{type:l.status===1?"success":"danger"},{default:o(()=>[i(D(l.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"description",label:"描述","show-overflow-tooltip":""}),t(d,{prop:"created_at",label:"创建时间",width:"180"},{default:o(({row:l})=>[i(D(ae(T)(l.created_at)),1)]),_:1}),t(d,{label:"操作",width:"200"},{default:o(({row:l})=>[t(v,{size:"small",onClick:X=>I(l)},{default:o(()=>[...e[19]||(e[19]=[i("编辑",-1)])]),_:1},8,["onClick"]),t(v,{size:"small",type:"danger",onClick:X=>O(l)},{default:o(()=>[...e[20]||(e[20]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[W,U.value]]),t(K,{"current-page":w.value,"onUpdate:currentPage":e[1]||(e[1]=l=>w.value=l),"page-size":z.value,"onUpdate:pageSize":e[2]||(e[2]=l=>z.value=l),total:C.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:c,onCurrentChange:c,style:{"margin-top":"20px"}},null,8,["current-page","page-size","total"]),t(J,{modelValue:b.value,"onUpdate:modelValue":e[16]||(e[16]=l=>b.value=l),title:$.value,width:"600px"},{footer:o(()=>[t(v,{onClick:e[15]||(e[15]=l=>b.value=!1)},{default:o(()=>[...e[23]||(e[23]=[i("取消",-1)])]),_:1}),t(v,{type:"primary",onClick:F},{default:o(()=>[...e[24]||(e[24]=[i("确定",-1)])]),_:1})]),default:o(()=>[t(Q,{model:a,rules:A,ref_key:"formRef",ref:S,"label-width":"100px"},{default:o(()=>[t(f,{label:"参数键",prop:"key"},{default:o(()=>[t(g,{modelValue:a.key,"onUpdate:modelValue":e[3]||(e[3]=l=>a.key=l),placeholder:"如：site_name"},null,8,["modelValue"])]),_:1}),t(f,{label:"参数标签",prop:"label"},{default:o(()=>[t(g,{modelValue:a.label,"onUpdate:modelValue":e[4]||(e[4]=l=>a.label=l),placeholder:"如：网站名称"},null,8,["modelValue"])]),_:1}),t(f,{label:"参数值",prop:"value"},{default:o(()=>[a.type==="text"?(m(),y(g,{key:0,modelValue:a.value,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value=l),placeholder:"请输入参数值"},null,8,["modelValue"])):a.type==="number"?(m(),y(M,{key:1,modelValue:a.value,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value=l),style:{width:"100%"}},null,8,["modelValue"])):a.type==="boolean"?(m(),y(L,{key:2,modelValue:a.value,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value=l),"active-text":"是","inactive-text":"否"},null,8,["modelValue"])):a.type==="textarea"?(m(),y(g,{key:3,modelValue:a.value,"onUpdate:modelValue":e[8]||(e[8]=l=>a.value=l),type:"textarea",rows:4,placeholder:"请输入参数值"},null,8,["modelValue"])):(m(),y(g,{key:4,modelValue:a.value,"onUpdate:modelValue":e[9]||(e[9]=l=>a.value=l),placeholder:"请输入参数值"},null,8,["modelValue"]))]),_:1}),t(f,{label:"参数类型",prop:"type"},{default:o(()=>[t(n,{modelValue:a.type,"onUpdate:modelValue":e[10]||(e[10]=l=>a.type=l),placeholder:"请选择类型"},{default:o(()=>[t(s,{label:"文本",value:"text"}),t(s,{label:"数字",value:"number"}),t(s,{label:"布尔值",value:"boolean"}),t(s,{label:"多行文本",value:"textarea"}),t(s,{label:"选择",value:"select"})]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"分组",prop:"group"},{default:o(()=>[t(g,{modelValue:a.group,"onUpdate:modelValue":e[11]||(e[11]=l=>a.group=l),placeholder:"如：system, email, upload"},null,8,["modelValue"])]),_:1}),t(f,{label:"排序",prop:"sort"},{default:o(()=>[t(M,{modelValue:a.sort,"onUpdate:modelValue":e[12]||(e[12]=l=>a.sort=l),min:0},null,8,["modelValue"])]),_:1}),t(f,{label:"状态",prop:"status"},{default:o(()=>[t(P,{modelValue:a.status,"onUpdate:modelValue":e[13]||(e[13]=l=>a.status=l)},{default:o(()=>[t(N,{value:1},{default:o(()=>[...e[21]||(e[21]=[i("启用",-1)])]),_:1}),t(N,{value:0},{default:o(()=>[...e[22]||(e[22]=[i("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"描述",prop:"description"},{default:o(()=>[t(g,{modelValue:a.description,"onUpdate:modelValue":e[14]||(e[14]=l=>a.description=l),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},fe=ne(de,[["__scopeId","data-v-1c4c772e"]]);export{fe as default};
