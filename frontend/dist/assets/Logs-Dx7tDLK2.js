import{r as i,b as G,m as K,d as k,o as f,e as O,f as l,M as W,g as t,h as s,a2 as X,p as g,H as x,E as P,Q as j,R as E,k as u,t as r,J as Z}from"./index-BI8oO-SX.js";import{f as ee}from"./date-B59vURDm.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={class:"logs-page"},te={__name:"Logs",setup(oe){const D=o=>o?ee(o):"",V=i(!1),M=i([]),v=i(1),y=i(10),h=i(0),w=i(!1),d=i(null),C=i([]),U=i([{label:"成功",value:1},{label:"失败",value:0}]),n=G({username:"",action:"",module:"",ip:"",status:null,start_date:"",end_date:""}),b=async()=>{V.value=!0;try{const o={page:v.value,page_size:y.value,...n};Object.keys(o).forEach(_=>{(o[_]===""||o[_]===null)&&delete o[_]});const e=await x.get("/logs",{params:o});M.value=e.data.data,h.value=e.data.total}catch{P.error("加载日志列表失败")}finally{V.value=!1}},z=()=>{v.value=1,b()},S=()=>{Object.assign(n,{username:"",action:"",module:"",ip:"",status:null,start_date:"",end_date:""}),z()},T=async()=>{try{const o=await x.get("/logs/options");C.value=(o.data.actions||[]).map(e=>({label:e,value:e})),Array.isArray(o.data.statuses)&&o.data.statuses.length>0&&(U.value=o.data.statuses.map(e=>({label:e.label,value:Number(e.value)})).filter(e=>!Number.isNaN(e.value)))}catch(o){console.error("加载日志筛选项失败",o)}},A=async o=>{try{const e=await x.get(`/logs/${o.id}`);d.value=e.data,w.value=!0}catch{P.error("获取日志详情失败")}};return K(()=>{T(),b()}),(o,e)=>{const _=s("el-input"),m=s("el-form-item"),N=s("el-option"),I=s("el-select"),L=s("el-date-picker"),Y=s("el-button"),F=s("el-form"),R=s("el-card"),c=s("el-table-column"),B=s("el-tag"),$=s("el-table"),H=s("el-pagination"),p=s("el-descriptions-item"),J=s("el-descriptions"),Q=s("el-dialog"),q=X("loading");return f(),k("div",ae,[e[13]||(e[13]=O("div",{class:"page-header"},[O("h2",null,"日志管理")],-1)),l(R,{style:{"margin-top":"20px"}},{default:t(()=>[l(F,{inline:!0,model:n,class:"search-form"},{default:t(()=>[l(m,{label:"用户名"},{default:t(()=>[l(_,{modelValue:n.username,"onUpdate:modelValue":e[0]||(e[0]=a=>n.username=a),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),l(m,{label:"操作类型"},{default:t(()=>[l(I,{modelValue:n.action,"onUpdate:modelValue":e[1]||(e[1]=a=>n.action=a),placeholder:"请选择",clearable:"",filterable:"",style:{"min-width":"140px"}},{default:t(()=>[(f(!0),k(j,null,E(C.value,a=>(f(),g(N,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"模块"},{default:t(()=>[l(_,{modelValue:n.module,"onUpdate:modelValue":e[2]||(e[2]=a=>n.module=a),placeholder:"请输入模块",clearable:""},null,8,["modelValue"])]),_:1}),l(m,{label:"IP地址"},{default:t(()=>[l(_,{modelValue:n.ip,"onUpdate:modelValue":e[3]||(e[3]=a=>n.ip=a),placeholder:"请输入IP地址",clearable:""},null,8,["modelValue"])]),_:1}),l(m,{label:"状态"},{default:t(()=>[l(I,{modelValue:n.status,"onUpdate:modelValue":e[4]||(e[4]=a=>n.status=a),placeholder:"请选择",clearable:"",style:{"min-width":"140px"}},{default:t(()=>[(f(!0),k(j,null,E(U.value,a=>(f(),g(N,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"开始日期"},{default:t(()=>[l(L,{modelValue:n.start_date,"onUpdate:modelValue":e[5]||(e[5]=a=>n.start_date=a),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",clearable:""},null,8,["modelValue"])]),_:1}),l(m,{label:"结束日期"},{default:t(()=>[l(L,{modelValue:n.end_date,"onUpdate:modelValue":e[6]||(e[6]=a=>n.end_date=a),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",clearable:""},null,8,["modelValue"])]),_:1}),l(m,null,{default:t(()=>[l(Y,{type:"primary",onClick:z},{default:t(()=>[...e[10]||(e[10]=[u("搜索",-1)])]),_:1}),l(Y,{onClick:S},{default:t(()=>[...e[11]||(e[11]=[u("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),W((f(),g($,{data:M.value,style:{"margin-top":"20px"}},{default:t(()=>[l(c,{prop:"username",label:"用户名",width:"120"}),l(c,{prop:"action",label:"操作",width:"100"}),l(c,{prop:"module",label:"模块",width:"200"}),l(c,{prop:"content",label:"内容","show-overflow-tooltip":""}),l(c,{prop:"ip",label:"IP地址",width:"150"}),l(c,{prop:"status",label:"状态",width:"100"},{default:t(({row:a})=>[l(B,{type:a.status===1?"success":"danger"},{default:t(()=>[u(r(a.status===1?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),l(c,{prop:"created_at",label:"时间",width:"180"},{default:t(({row:a})=>[u(r(a.created_at?D(a.created_at):""),1)]),_:1}),l(c,{label:"操作",width:"100"},{default:t(({row:a})=>[l(Y,{size:"small",onClick:ne=>A(a)},{default:t(()=>[...e[12]||(e[12]=[u("查看",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[q,V.value]]),l(H,{"current-page":v.value,"onUpdate:currentPage":e[7]||(e[7]=a=>v.value=a),"page-size":y.value,"onUpdate:pageSize":e[8]||(e[8]=a=>y.value=a),total:h.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:b,onCurrentChange:b,style:{"margin-top":"20px"}},null,8,["current-page","page-size","total"]),l(Q,{modelValue:w.value,"onUpdate:modelValue":e[9]||(e[9]=a=>w.value=a),title:"日志详情",width:"600px"},{default:t(()=>[d.value?(f(),g(J,{key:0,column:1,border:""},{default:t(()=>[l(p,{label:"ID"},{default:t(()=>[u(r(d.value.id),1)]),_:1}),l(p,{label:"用户名"},{default:t(()=>[u(r(d.value.username),1)]),_:1}),l(p,{label:"操作"},{default:t(()=>[u(r(d.value.action),1)]),_:1}),l(p,{label:"模块"},{default:t(()=>[u(r(d.value.module),1)]),_:1}),l(p,{label:"内容"},{default:t(()=>[u(r(d.value.content),1)]),_:1}),l(p,{label:"IP地址"},{default:t(()=>[u(r(d.value.ip),1)]),_:1}),l(p,{label:"用户代理"},{default:t(()=>[u(r(d.value.user_agent),1)]),_:1}),l(p,{label:"状态"},{default:t(()=>[l(B,{type:d.value.status===1?"success":"danger"},{default:t(()=>[u(r(d.value.status===1?"成功":"失败"),1)]),_:1},8,["type"])]),_:1}),l(p,{label:"时间"},{default:t(()=>[u(r(d.value.created_at?D(d.value.created_at):""),1)]),_:1})]),_:1})):Z("",!0)]),_:1},8,["modelValue"])])}}},re=le(te,[["__scopeId","data-v-86cc6bca"]]);export{re as default};
